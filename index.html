<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>حكاية اليمن: بين الحضارة والإمامة</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* Modern Yemeni flag color palette */
        :root {
            --red: #C8102E;     /* Yemeni Flag Red */
            --white: #FFFFFF;
            --black: #000000;
            --green: #007A3D;   /* Yemeni Flag Green */
        }
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--black);
            color: var(--white);
        }
        .tajawal-bold { font-weight: 700; }
        .bg-primary { background-color: var(--black); }
        .bg-secondary { background-color: #1a1a1a; } /* A slightly lighter black for contrast */
        .bg-card { background-color: #1a1a1a; }
        .bg-accent-red { background-color: var(--red); }
        .bg-accent-green { background-color: var(--green); }
        .text-primary { color: var(--white); }
        .text-accent-red { color: var(--red); }
        .text-accent-green { color: var(--green); }
        .border-accent-red { border-color: var(--red); }
        .border-accent-green { border-color: var(--green); }

        .nav-link {
            transition: color 0.3s, border-bottom-color 0.3s;
            position: relative;
        }
        .nav-link::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: -5px;
            width: 100%;
            height: 2px;
            background-color: var(--red);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        .nav-link:hover::after {
            transform: scaleX(1);
        }
        .card {
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(255, 255, 255, 0.1), 0 4px 6px -2px rgba(255, 255, 255, 0.05);
        }
        .interactive-button {
            transition: background-color 0.3s, color 0.3s, transform 0.2s;
        }
        .interactive-button:hover {
            transform: translateY(-2px);
        }
        .active-button {
            background-color: var(--green) !important;
            color: var(--white) !important;
        }
        .resistance-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        .resistance-card {
            width: 100%;
            max-width: 600px;
            background-color: #1a1a1a;
            border: 2px solid var(--red);
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(255, 255, 255, 0.1), 0 2px 4px -1px rgba(255, 255, 255, 0.06);
            padding: 2rem;
            text-align: center;
            opacity: 1;
            transition: opacity 0.5s ease-in-out, transform 0.3s;
        }
        .resistance-card.fade-out {
            opacity: 0;
        }
        .nav-buttons {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-top: 2rem;
        }
        .nav-button {
            background-color: var(--red);
            color: var(--white);
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            font-weight: 700;
            transition: background-color 0.3s, transform 0.2s;
        }
        .nav-button:hover:not(:disabled) {
            background-color: #A30D25;
            transform: translateY(-2px);
        }
        .nav-button:disabled {
            background-color: #6a6a6a;
            cursor: not-allowed;
        }
        .gemini-output {
            background-color: #333;
            border-left: 4px solid var(--green);
            padding: 1rem;
            border-radius: 0.5rem;
        }
    </style>
</head>
<body class="bg-primary">

    <!-- Header and Navigation -->
    <header class="bg-secondary shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-3">
            <div class="flex items-center justify-between">
                <div class="text-xl tajawal-bold text-accent-red">حكاية اليمن</div>
                <div class="hidden md:flex items-center space-x-8 lg:space-x-10">
                    <a href="#paradox" class="nav-link text-white">المفارقة</a>
                    <a href="#eras" class="nav-link text-white">بين عصرين</a>
                    <a href="#control" class="nav-link text-white">منهجية السيطرة</a>
                    <a href="#decline" class="nav-link text-white">أدوات التدهور</a>
                    <a href="#resistance" class="nav-link text-white">روح المقاومة</a>
                    <a href="#gemini" class="nav-link text-white">اسأل Gemini</a>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <!-- Section: Hero - Paradox -->
        <section id="paradox" class="min-h-screen flex items-center justify-center bg-primary text-center p-6">
            <div class="container mx-auto">
                <!-- Yemeni Flag SVG -->
                <div class="mb-8">
                    <svg class="w-48 h-32 mx-auto" viewBox="0 0 100 60" xmlns="http://www.w3.org/2000/svg">
                        <!-- Red Stripe -->
                        <rect x="0" y="0" width="100" height="20" fill="#C8102E"/>
                        <!-- White Stripe -->
                        <rect x="0" y="20" width="100" height="20" fill="#FFFFFF"/>
                        <!-- Black Stripe -->
                        <rect x="0" y="40" width="100" height="20" fill="#000000"/>
                        <!-- Green Star -->
                          </svg>
                </div>
                <h1 class="text-5xl md:text-7xl tajawal-bold text-accent-red mb-6 animate-pulse">المفارقة اليمنية</h1>
                <p class="text-lg md:text-2xl max-w-4xl mx-auto text-white">
                    يستكشف هذا التطبيق المفارقة اليمنية: كيف تحول مهد الحضارات إلى ساحة للتكتلات القبلية والجهل تحت حكم الأئمة.
                </p>
                <div class="mt-12">
                    <svg class="w-12 h-12 mx-auto text-white animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </div>
            </div>
        </section>

        <!-- Section: Two Eras Comparison -->
        <section id="eras" class="py-20 bg-secondary">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-4xl md:text-5xl tajawal-bold text-accent-green">اليمن بين عصرين</h2>
                    <p class="mt-4 text-lg text-white">مقارنة تفاعلية بين يمن الحضارات ويمن الإمامة. اختر جانبًا للمقارنة.</p>
                </div>

                <div id="comparison-buttons" class="flex flex-wrap justify-center gap-4 mb-10">
                    <button data-topic="society" class="interactive-button px-8 py-3 rounded-full border-2 border-accent-green text-white tajawal-bold active-button">المجتمع والحكم</button>
                    <button data-topic="economy" class="interactive-button px-8 py-3 rounded-full border-2 border-accent-green text-white tajawal-bold">الاقتصاد والموارد</button>
                    <button data-topic="knowledge" class="interactive-button px-8 py-3 rounded-full border-2 border-accent-green text-white tajawal-bold">العلم والتعليم</button>
                </div>

                <div class="grid md:grid-cols-2 gap-8">
                    <!-- Civilization card -->
                    <div class="bg-card p-8 rounded-lg shadow-xl border border-white">
                        <h3 class="text-3xl tajawal-bold text-accent-red mb-4">☀️ يمن الحضارات</h3>
                        <div id="civilization-content"></div>
                    </div>
                    <!-- Imamate card -->
                    <div class="bg-card p-8 rounded-lg shadow-xl border border-white">
                        <h3 class="text-3xl tajawal-bold text-accent-red mb-4">🌙 يمن الإمامة</h3>
                        <div id="imamate-content"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section: Ideology of Control -->
        <section id="control" class="py-20 bg-primary">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-4xl md:text-5xl tajawal-bold text-accent-red">منهجية السيطرة</h2>
                    <p class="mt-4 text-lg text-white">لم يكن التدهور عرضيًا، بل نتيجة لأيديولوجية حكم قامت على شرطين: النسب، و"الدعوة بالسيف".</p>
                </div>
                <div class="max-w-4xl mx-auto bg-card p-8 rounded-lg shadow-xl border border-white">
                    <div class="flex items-start">
                        <div class="ml-4">
                            <h3 class="text-3xl tajawal-bold text-accent-green">الدعوة المصحوبة بالسيف</h3>
                            <p class="mt-4 text-white">
                                هذا المبدأ الأساسي في المذهب الزيدي الهادوي يشرعن الصراع المسلح كطريق أساسي للسلطة. القيادة لا تأتي بالإجماع أو الكفاءة الإدارية، بل بالقدرة على حمل السلاح والقتال. هذه الفكرة بطبيعتها عززت ثقافة الصراع الدائم على الحكم ومنعت الاستقرار، مما يفسر "التكتلات القبلية التي تغزو بعضها بعضًا".
                            </p>
                            <p class="mt-4 text-sm text-gray-400">
                                تأسست الإمامة عام <strong>898م</strong> واستمرت حتى ثورة <strong>1962م</strong>، في واحدة من أطول فترات الحكم في التاريخ، والتي تميزت بالصراعات الداخلية والخارجية المستمرة.
                            </p>
                        </div>
                        <div class="text-5xl text-accent-red">⚔️</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section: Tools of Decline -->
        <section id="decline" class="py-20 bg-secondary">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-4xl md:text-5xl tajawal-bold text-accent-green">أدوات التدهور</h2>
                    <p class="mt-4 text-lg text-white">استخدم الأئمة سياسات ممنهجة لتفتيت المجتمع وإفقاره وتجهيله لضمان السيطرة والبقاء. اضغط على الزر ✨ لمعرفة التأثيرات الحديثة.</p>
                </div>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Card 1 -->
                    <div class="card bg-card p-6 rounded-lg shadow-xl border border-white" data-policy="نظام الرهائن">
                        <div class="flex items-center mb-3">
                            <span class="text-3xl ml-4 text-accent-red">⛓️</span>
                            <h4 class="text-xl tajawal-bold text-white">نظام الرهائن</h4>
                        </div>
                        <p class="text-gray-300">إخضاع القبائل عبر أخذ أبناء الشيوخ كرهائن لضمان ولائهم. قُدّر وجود 4000 رهينة في قصور الإمام أحمد عام 1939.</p>
                        <div class="mt-4 pt-4 border-t border-gray-700">
                            <button class="gemini-btn w-full px-4 py-2 bg-accent-red text-white rounded-md tajawal-bold hover:opacity-80">✨ شاهد التأثير الحديث</button>
                            <div class="gemini-output mt-2 text-sm text-gray-400"></div>
                        </div>
                    </div>
                    <!-- Card 2 -->
                    <div class="card bg-card p-6 rounded-lg shadow-xl border border-white" data-policy="فتوى الخراج">
                        <div class="flex items-center mb-3">
                            <span class="text-3xl ml-4 text-accent-red">💸</span>
                            <h4 class="text-xl tajawal-bold text-white">فتوى الخراج</h4>
                        </div>
                        <p class="text-gray-300">تحويل أراضي اليمنيين إلى "خراجية" (غنيمة حرب)، مما شرعن فرض ضرائب باهظة ومصادرة الثروات تحت غطاء ديني.</p>
                        <div class="mt-4 pt-4 border-t border-gray-700">
                            <button class="gemini-btn w-full px-4 py-2 bg-accent-red text-white rounded-md tajawal-bold hover:opacity-80">✨ شاهد التأثير الحديث</button>
                            <div class="gemini-output mt-2 text-sm text-gray-400"></div>
                        </div>
                    </div>
                    <!-- Card 3 -->
                    <div class="card bg-card p-6 rounded-lg shadow-xl border border-white" data-policy="تدمير التعليم">
                        <div class="flex items-center mb-3">
                            <span class="text-3xl ml-4 text-accent-red">🚫</span>
                            <h4 class="text-xl tajawal-bold text-white">تدمير التعليم</h4>
                        </div>
                        <p class="text-gray-300">محاربة التعليم الحديث وإغلاق المدارس تحت شعار "الشعب الجاهل أسهل حكمًا وقيادة". تم تحويل "دار الصنايع" إلى سجن.</p>
                        <div class="mt-4 pt-4 border-t border-gray-700">
                            <button class="gemini-btn w-full px-4 py-2 bg-accent-red text-white rounded-md tajawal-bold hover:opacity-80">✨ شاهد التأثير الحديث</button>
                            <div class="gemini-output mt-2 text-sm text-gray-400"></div>
                        </div>
                    </div>
                    <!-- Card 4 -->
                    <div class="card bg-card p-6 rounded-lg shadow-xl border border-white" data-policy="التحريش بين القبائل">
                        <div class="flex items-center mb-3">
                            <span class="text-3xl ml-4 text-accent-red">⚔️</span>
                            <h4 class="text-xl tajawal-bold text-white">التحريش بين القبائل</h4>
                        </div>
                        <p class="text-gray-300">تعبئة القبائل ضد بعضها البعض، واستخدامها كأدوات عسكرية، مما منع قيام هوية وطنية موحدة يمكن أن تتحدى حكمهم.</p>
                        <div class="mt-4 pt-4 border-t border-gray-700">
                            <button class="gemini-btn w-full px-4 py-2 bg-accent-red text-white rounded-md tajawal-bold hover:opacity-80">✨ شاهد التأثير الحديث</button>
                            <div class="gemini-output mt-2 text-sm text-gray-400"></div>
                        </div>
                    </div>
                    <!-- Card 5 -->
                    <div class="card bg-card p-6 rounded-lg shadow-xl border border-white" data-policy="غياب التنمية">
                        <div class="flex items-center mb-3">
                            <span class="text-3xl ml-4 text-accent-red">📉</span>
                            <h4 class="text-xl tajawal-bold text-white">غياب التنمية</h4>
                        </div>
                        <p class="text-gray-300">نهج غير تنموي يهدف إلى هدم ما هو قائم بدلاً من البناء، مما أدى إلى ركود اقتصادي وتجاري وصناعي شامل.</p>
                        <div class="mt-4 pt-4 border-t border-gray-700">
                            <button class="gemini-btn w-full px-4 py-2 bg-accent-red text-white rounded-md tajawal-bold hover:opacity-80">✨ شاهد التأثير الحديث</button>
                            <div class="gemini-output mt-2 text-sm text-gray-400"></div>
                        </div>
                    </div>
                    <!-- Card 6 -->
                    <div class="card bg-card p-6 rounded-lg shadow-xl border border-white" data-policy="الاضطهاد الطائفي">
                        <div class="flex items-center mb-3">
                            <span class="text-3xl ml-4 text-accent-red">🎭</span>
                            <h4 class="text-xl tajawal-bold text-white">الاضطهاد الطائفي</h4>
                        </div>
                        <p class="text-gray-300">فرض المذهب الزيدي بالقوة، وتكفير المخالفين مثل الشوافع، وإبادة طوائف كاملة مثل المطرفية لرفضها شرط النسب.</p>
                        <div class="mt-4 pt-4 border-t border-gray-700">
                            <button class="gemini-btn w-full px-4 py-2 bg-accent-red text-white rounded-md tajawal-bold hover:opacity-80">✨ شاهد التأثير الحديث</button>
                            <div class="gemini-output mt-2 text-sm text-gray-400"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section: Resistance -->
        <section id="resistance" class="py-20 bg-primary">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-4xl md:text-5xl tajawal-bold text-accent-red">روح المقاومة</h2>
                    <p class="mt-4 text-lg text-white">"كلما أفاق الشعب أعادوه". لم يكن حكم الإمامة مستقرًا أبدًا، بل قوبل بثورات وانتفاضات مستمرة.</p>
                </div>
                <div class="resistance-container">
                    <div id="resistance-card" class="resistance-card">
                        <p class="text-2xl tajawal-bold text-accent-green mb-2" id="event-year">...</p>
                        <h4 class="text-xl tajawal-bold text-white mb-2" id="event-title">...</h4>
                        <p class="text-gray-300 text-sm" id="event-description">...</p>
                    </div>
                    <div class="nav-buttons">
                        <button id="prev-btn" class="nav-button">السابق</button>
                        <span id="event-counter" class="text-white tajawal-bold">1 من 6</span>
                        <button id="next-btn" class="nav-button">التالي</button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Section: Ask Gemini -->
        <section id="gemini" class="py-20 bg-secondary">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-4xl md:text-5xl tajawal-bold text-accent-green">✨ اسأل Gemini عن تاريخ اليمن</h2>
                    <p class="mt-4 text-lg text-white">اكتب سؤالك هنا للحصول على إجابات مفصلة ومُولَّدة بالذكاء الاصطناعي حول تاريخ اليمن.</p>
                </div>
                <div class="max-w-4xl mx-auto p-8 bg-card rounded-lg shadow-xl border border-white">
                    <textarea id="gemini-input" class="w-full h-32 p-4 mb-4 border-2 border-gray-700 bg-black text-white rounded-lg focus:outline-none focus:border-accent-green" placeholder="اكتب سؤالك هنا، مثلاً: ما هي نتائج ثورة 26 سبتمبر 1962؟"></textarea>
                    <button id="gemini-ask-btn" class="w-full px-6 py-3 bg-accent-red text-white rounded-lg tajawal-bold hover:opacity-80 transition-opacity">
                        اسأل Gemini
                    </button>
                    <div id="gemini-response" class="mt-6 p-4 gemini-output text-gray-300">
                        <p class="text-sm">سيظهر الرد هنا...</p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-secondary mt-20">
        <div class="container mx-auto px-6 py-12 text-center text-white">
            <h3 class="text-3xl tajawal-bold text-accent-red mb-4">الخلاصة: إرث الماضي وتحديات الحاضر</h3>
            <p class="max-w-5xl mx-auto">
                إن سياسات الإمامة الممنهجة في التجهيل والإفقار والتفريق لم تكن مجرد فشل في الحكم، بل استراتيجية ناجحة للبقاء في السلطة على حساب الوطن. إرث الانقسامات القبلية، وتدمير الاقتصاد، وتغييب الوعي لا يزال يؤثر بعمق على اليمن المعاصر. فهم هذا التاريخ ليس ترفًا، بل ضرورة لفهم جذور الصراع الحالي ورسم طريق نحو مستقبل أفضل.
            </p>
            <!-- Prominent link to the Google Doc -->
            <div class="mt-8">
                <a href="https://docs.google.com/document/d/1yrtG4Waw3kqU_thBvTzMYsnSe8WdFFDqPM6WmHv4hqg/edit?tab=t.0" target="_blank" class="inline-block px-8 py-4 bg-accent-green text-white rounded-lg tajawal-bold text-lg hover:opacity-80 transition-opacity">
                    قراءة التقرير الكامل
                </a>
            </div>
            <p class="mt-8 text-sm text-gray-500">تم إنشاء هذا التطبيق التفاعلي بناءً على تقرير "تحول اليمن: من مجتمع حضاري إلى تكتلات قبلية" مع ميزات إضافية مدعومة بـ Gemini.</p>
        </div>
    </footer>

    <script>
        // Data for the comparison section
        const comparisonData = {
            society: {
                civilization: `
                    <ul class="space-y-3 list-inside">
                        <li class="flex items-start"><span class="text-accent-green ml-2">🏛️</span> <span>ممالك قوية ومتقدمة (سبأ، حمير) بنظام إداري متطور.</span></li>
                        <li class="flex items-start"><span class="text-accent-green ml-2">⚖️</span> <span>قوانين مدنية تنظم التجارة والزراعة والحياة العامة.</span></li>
                        <li class="flex items-start"><span class="text-accent-green ml-2">🌍</span> <span>مجتمع منفتح على العالم عبر التجارة الدولية.</span></li>
                        <li class="flex items-start"><span class="text-accent-green ml-2">🤝</span> <span>هوية جامعة تتمحور حول المملكة وإنجازاتها.</span></li>
                    </ul>
                `,
                imamate: `
                    <ul class="space-y-3 list-inside">
                        <li class="flex items-start"><span class="text-accent-red ml-2">⚔️</span> <span>تكتلات قبلية متناحرة، الولاء للقبيلة والإمام لا للوطن.</span></li>
                        <li class="flex items-start"><span class="text-accent-red ml-2">⛓️</span> <span>نظام الرهائن لإخضاع القبائل وزرع الخوف.</span></li>
                        <li class="flex items-start"><span class="text-accent-red ml-2">🔒</span> <span>مجتمع منغلق ومعزول عن التطورات العالمية.</span></li>
                        <li class="flex items-start"><span class="text-accent-red ml-2">🎭</span> <span>تمييز طائفي واجتماعي (مثل "بني الخمس").</span></li>
                    </ul>
                `
            },
            economy: {
         AIzaSyD1UCuwgpJNVEkJnOpPyMv7I3nSpTrNBPk    <ul class="space-y-3 list-inside">
                        <li class="flex items-start"><span class="text-accent-green ml-2">🌾</span> <span>زراعة متطورة (سد مأرب، المدرجات) وإنتاج وفير.</span></li>
                        <li class="flex items-start"><span class="text-accent-green ml-2">🚢</span> <span>مركز تجاري عالمي للبخور والعطور والسلع الفاخرة.</span></li>
                        <li class="flex items-start"><span class="text-accent-green ml-2">🛠️</span> <span>صناعات متقدمة مثل السيوف اليمنية والأقمشة الفاخرة.</span></li>
                        <li class="flex items-start"><span class="text-accent-green ml-2">💧</span> <span>بنية تحتية متطورة (سدود، قنوات ري، قصور).</span></li>
                    </ul>
                `,
                imamate: `
                    <ul class="space-y-3 list-inside">
                        <li class="flex items-start"><span class="text-accent-red ml-2">💸</span> <span>ضرائب استغلالية (الخراج والخمس) لإفقار الشعب.</span></li>
                        <li class="flex items-start"><span class="text-accent-red ml-2">📉</span> <span>ركود اقتصادي وتدمير للبنية التحتية القائمة.</span></li>
                        <li class="flex items-start"><span class="text-accent-red ml-2">💰</span> <span>مصادرة الثروات والتلاعب بالعملة لخدمة الحاكم.</span></li>
                        <li class="flex items-start"><span class="text-accent-red ml-2">🏚️</span> <span>شعب يقاتل من أجل قوت يومه في ظل الفقر المدقع.</span></li>
                    </ul>
                `
            },
            knowledge: {
                civilization: `
                    <ul class="space-y-3 list-inside">
                         <li class="flex items-start"><span class="text-accent-green ml-2">📐</span> <span>براعة هندسية ومعمارية (قصر غمدان، السدود).</span></li>
                         <li class="flex items-start"><span class="text-accent-green ml-2">✍️</span> <span>نظام كتابة خاص (المسند) وتوثيق للتاريخ والإنجازات.</span></li>
                         <li class="flex items-start"><span class="text-accent-green ml-2">🎨</span> <span>فنون ونحت ونقوش تزين المباني والمعابد.</span></li>
                         <li class="flex items-start"><span class="text-accent-green ml-2">🗺️</span> <span>معرفة جغرافية وفلكية لخدمة التجارة والزراعة.</span></li>
                    </ul>
                `,
                imamate: `
                    <ul class="space-y-3 list-inside">
                        <li class="flex items-start"><span class="text-accent-red ml-2">🚫</span> <span>سياسة تجهيل متعمد ومحاربة للعلوم الحديثة.</span></li>
                        <li class="flex items-start"><span class="text-accent-red ml-2">📖</span> <span>تعليم ديني محدود يركز على الحفظ وترسيخ الطاعة.</span></li>
                        <li class="flex items-start"><span class="text-accent-red ml-2">🔒</span> <span>قيود صارمة على المكتبات والوصول للمعرفة.</span></li>
                        <li class="flex items-start"><span class="text-accent-red ml-2">🏰</span> <span>تحويل المؤسسات التعليمية إلى سجون ومعتقلات.</span></li>
                    </ul>
                `
            }
        };

        // Prompts for the Gemini API
        const policyPrompts = {
            'نظام الرهائن': 'اشرح كيف يمكن أن يؤدي نظام الرهائن التاريخي إلى إضعاف النسيج الاجتماعي والثقة بين مكونات المجتمع في العصر الحديث.',
            'فتوى الخراج': 'صف كيف يمكن أن تتجلى سياسات مصادرة الثروات والضرائب الجائرة مثل "الخراج" في الاقتصاد الحديث، وما هي تأثيراتها على التنمية؟',
            'تدمير التعليم': 'اشرح كيف يمكن لسياسة تدمير التعليم وتجهيل الشعب أن تؤدي إلى تبعات اجتماعية واقتصادية طويلة الأمد في أي مجتمع حديث.',
            'التحريش بين القبائل': 'اشرح كيف يمكن أن تؤدي سياسة "التحريش بين القبائل" إلى انقسامات مجتمعية وصراعات داخلية مستمرة في العصر الحديث.',
            'غياب التنمية': 'اشرح كيف يمكن أن يؤدي "غياب التنمية" والتركيز على الهدم بدلاً من البناء إلى تدهور اقتصادي شامل في الدول المعاصرة.',
            'الاضطهاد الطائفي': 'صف كيف يمكن أن يؤدي "الاضطهاد الطائفي" إلى صراعات مجتمعية وتهديد للهوية الوطنية في العصر الحديث.'
        };
        
        // Data for the resistance section
        const resistanceEvents = [
            {
                year: '1217',
                title: 'ثورة المطرفية',
                description: 'حركة فكرية ومذهبية رفضت شرط "النسب" كشرط للحكم، مما أدى إلى إبادتها على يد الإمام المنصور عبد الله بن حمزة. تعتبر هذه الحركة أول مقاومة فكرية كبيرة.'
            },
            {
                year: '1558',
                title: 'صراعات المتوكل شرف الدين',
                description: 'موجة من الصراعات العسكرية والتمردات الداخلية ضد حكم الإمام، والتي كشفت عن هشاشة النظام الإمامي وعدم استقراره.'
            },
            {
                year: '1928',
                title: 'ثورة الزرانيق',
                description: 'انتفاضة مسلحة لقبيلة الزرانيق ضد نظام الإمام يحيى حميد الدين، قوبلت بوحشية شديدة من قبل الإمامة، مما أظهر شراسة النظام في قمع أي تمرد.'
            },
            {
                year: '1948',
                title: 'ثورة الدستور',
                description: 'حركة وطنية سعت لإقامة حكم دستوري بدلاً من الحكم المطلق، انتهت باغتيال الإمام يحيى لكنها فشلت في إقامة الدولة الحديثة.'
            },
            {
                year: '1955',
                title: 'حركة الثلايا',
                description: 'محاولة انقلابية قادها العقيد أحمد الثلايا ضد الإمام أحمد حميد الدين، فشلت لكنها كانت مؤشرًا على تزايد السخط داخل المؤسسة العسكرية.'
            },
            {
                year: '1962',
                title: 'ثورة 26 سبتمبر',
                description: 'الثورة التي أنهت حكم الإمامة المستمر لقرون، وأسست الجمهورية العربية اليمنية، معلنة بداية عصر جديد في تاريخ اليمن.'
            }
        ];

        let currentEventIndex = 0;

        document.addEventListener('DOMContentLoaded', function() {
            const civilizationContent = document.getElementById('civilization-content');
            const imamateContent = document.getElementById('imamate-content');
            const buttons = document.querySelectorAll('#comparison-buttons button');
            const geminiInput = document.getElementById('gemini-input');
            const geminiAskBtn = document.getElementById('gemini-ask-btn');
            const geminiResponseDiv = document.getElementById('gemini-response');
            const policyButtons = document.querySelectorAll('.gemini-btn');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const eventCounter = document.getElementById('event-counter');
            const resistanceCard = document.getElementById('resistance-card');
            const eventYearEl = document.getElementById('event-year');
            const eventTitleEl = document.getElementById('event-title');
            const eventDescriptionEl = document.getElementById('event-description');

            // Function to render the current resistance event with a fade effect
            function renderResistanceEvent() {
                resistanceCard.classList.add('fade-out');
                setTimeout(() => {
                    const event = resistanceEvents[currentEventIndex];
                    eventYearEl.textContent = event.year;
                    eventTitleEl.textContent = event.title;
                    eventDescriptionEl.textContent = event.description;
                    eventCounter.textContent = `${currentEventIndex + 1} من ${resistanceEvents.length}`;
                    resistanceCard.classList.remove('fade-out');
                }, 300);
                prevBtn.disabled = currentEventIndex === 0;
                nextBtn.disabled = currentEventIndex === resistanceEvents.length - 1;
            }

            // Event listeners for navigation buttons
            prevBtn.addEventListener('click', () => {
                if (currentEventIndex > 0) {
                    currentEventIndex--;
                    renderResistanceEvent();
                }
            });

            nextBtn.addEventListener('click', () => {
                if (currentEventIndex < resistanceEvents.length - 1) {
                    currentEventIndex++;
                    renderResistanceEvent();
                }
            });

            renderResistanceEvent();

            // Asynchronous function to call the Gemini API
            async function fetchGeminiResponse(prompt) {
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        return result.candidates[0].content.parts[0].text;
                    } else {
                        return 'حدث خطأ في الحصول على الإجابة. يرجى المحاولة مرة أخرى.';
                    }
                } catch (error) {
                    console.error('Error fetching Gemini response:', error);
                    return 'حدث خطأ في الاتصال بالخدمة. يرجى التحقق من اتصالك بالإنترنت.';
                }
            }

            // Function to handle the policy button click
            async function handleGeminiPolicyRequest(event) {
                const button = event.target;
                const card = button.closest('.card');
                const policyName = card.dataset.policy;
                const outputDiv = card.querySelector('.gemini-output');
                const originalText = button.textContent;

                button.textContent = 'جارٍ التحميل...';
                button.disabled = true;

                const prompt = policyPrompts[policyName];
                const responseText = await fetchGeminiResponse(prompt);

                outputDiv.innerHTML = `<strong class="text-accent-green">التأثير الحديث:</strong> ${responseText}`;
                button.textContent = originalText;
                button.disabled = false;
            }

            // Function to handle the main Gemini chat request
            async function handleGeminiChatRequest() {
                const userQuestion = geminiInput.value.trim();
                if (!userQuestion) {
                    geminiResponseDiv.innerHTML = '<p class="text-red-500">من فضلك اكتب سؤالك أولاً.</p>';
                    return;
                }

                geminiAskBtn.textContent = 'جارٍ الإجابة...';
                geminiAskBtn.disabled = true;
                geminiResponseDiv.innerHTML = '<p class="text-gray-400">جاري البحث عن إجابة...</p>';

                const prompt = `أجب عن السؤال التالي حول تاريخ اليمن، مع التركيز على فهم سياقه: "${userQuestion}"`;
                const responseText = await fetchGeminiResponse(prompt);

                geminiResponseDiv.innerHTML = responseText;
                geminiAskBtn.textContent = 'اسأل Gemini';
                geminiAskBtn.disabled = false;
            }

            // Function to update the content in the comparison section
            function updateContent(topic) {
                civilizationContent.innerHTML = comparisonData[topic].civilization;
                imamateContent.innerHTML = comparisonData[topic].imamate;
                buttons.forEach(button => {
                    button.classList.remove('active-button');
                    if (button.dataset.topic === topic) {
                        button.classList.add('active-button');
                    }
                });
            }

            buttons.forEach(button => {
                button.addEventListener('click', () => {
                    updateContent(button.dataset.topic);
                });
            });

            updateContent('society');

            // Smooth scrolling for navigation links
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        window.scrollTo({
                            top: targetElement.offsetTop - 70, 
                            behavior: 'smooth'
                        });
                    }
                });
            });

            policyButtons.forEach(button => {
                button.addEventListener('click', handleGeminiPolicyRequest);
            });

            geminiAskBtn.addEventListener('click', handleGeminiChatRequest);
        });
    </script>
</body>
</html>
